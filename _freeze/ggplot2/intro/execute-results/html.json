{
  "hash": "8b186a5035abdf33aad1bb7002e3e460",
  "result": {
    "engine": "knitr",
    "markdown": "\n# Exploring data with `ggplot2`\n\nThis chapter is based on the [Intro to ggplot2 chapter](https://rkabacoff.github.io/datavis/IntroGGPLOT.html) from the book [Modern Data Visualization with R](https://rkabacoff.github.io/datavis/) by Robert Kabacoff, which is licensed under the [Creative Commons Attribution-NonCommercial 4.0 International License](https://creativecommons.org/licenses/by-nc/4.0/). The original chapter has been modified to fit the context of this book.\n\nThe [insurance dataset](https://www.kaggle.com/datasets/mirichoi0218/insurance) is described in the book Machine Learning with R by Brett Lantz. A cleaned version of the dataset is also available on Kaggle. The dataset describes medical information and costs billed by health insurance companies in 2013, as compiled by the United States Census Bureau. Variables include age, sex, body mass index, number of children covered by health insurance, smoker status, US region, and individual medical costs billed by health insurance for 1338 individuals.\n\n\n::: {.cell}\n\n:::\n\n\nIn this chapter, we will explore the dataset using `ggplot2`, a powerful visualization package in R. \n\nTo get started, we need to install and load the `ggplot2` package. If you haven't installed it yet, you can do so using the following command:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"ggplot2\")\n```\n:::\n\n\nOnce installed, load the package:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n```\n:::\n\n\nNext, we will read the insurance dataset into R. We'll use a convenient online version of the dataset and use the `read.csv` function to load it:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load the data\nurl <- \"https://tinyurl.com/mtktm8e5\"\ninsurance <- read.csv(url)\n```\n:::\n\n\nIn Rstudio, you can use the `View()` function to inspect the dataset:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# view the dataset\nView(insurance)\n```\n:::\n\n\nNext, we’ll add a variable indicating if the patient is obese or not. Obesity will be defined as a body mass index greater than or equal to 30.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# create an obesity variable\ninsurance$obese <- ifelse(insurance$bmi >= 30, \n                          \"obese\", \"not obese\")\n```\n:::\n\n\nIn building a ggplot2 graph, only the first two functions described below are required. The others are optional and can appear in any order.\n\n## `ggplot()`\n\nThe `ggplot()` function initializes the plot. It takes a data frame as its first argument and can also include aesthetic mappings (aes) that define how variables in the data are mapped to visual properties of the plot, such as x and y axes, color, size, etc.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# initialize the plot\nggplot(data = insurance, aes(x = age, y = expenses))\n```\n\n::: {.cell-output-display}\n![Initialize the plot with ggplot()](intro_files/figure-html/fig-ggplot-init-1.png){#fig-ggplot-init width=672}\n:::\n:::\n\n\nWhy is @fig-ggplot-init not showing a plot? Because we have not added any layers to the plot yet. The `ggplot()` function only initializes the plot; it does not display anything until we add layers. We specified that the age variable should be mapped to the x-axis and that the expenses should be mapped to the y-axis, but we haven’t yet specified what we wanted placed on the graph.\n\n## `geom_*()`\n\nThe `geom_*()` functions add layers to the plot. Each `geom_*()` function corresponds to a specific type of geometric object, such as points, lines, bars, etc. For example, `geom_point()` adds points to the plot, while `geom_line()` adds lines.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add points to the plot\nggplot(data = insurance,\n       mapping = aes(x = age, y = expenses)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![Add points to the plot with geom_point()](intro_files/figure-html/fig-ggplot-geom-point-1.png){#fig-ggplot-geom-point width=672}\n:::\n:::\n\n\nIn @fig-ggplot-geom-point, we added points to the plot using `geom_point()`. The `+` operator is used to add layers to the plot. The `mapping` argument in `aes()` specifies how variables in the data are mapped to visual properties of the plot.\n\nWe can see in @fig-ggplot-geom-point that insurance expenses increase with age, but there is a lot of variability in the data.\n\nA number of parameters (options) can be specified in a geom_ function. Options for the geom_point function include color, size, and alpha. These control the point color, size, and transparency, respectively. Transparency ranges from 0 (completely transparent) to 1 (completely opaque). Adding a degree of transparency can help visualize overlapping points.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# make points blue, larger, and semi-transparent\nggplot(data = insurance,\n       mapping = aes(x = age, y = expenses)) +\n  geom_point(color = \"cornflowerblue\",\n             alpha = .7,\n             size = 2)\n```\n\n::: {.cell-output-display}\n![Modify point color, size, and transparency.](intro_files/figure-html/fig-ggplot-geom-point-options-1.png){#fig-ggplot-geom-point-options width=672}\n:::\n:::\n\n\nNext, we can add a line of best fit; in essence, we will layer on a regression fit. We can do this with the geom_smooth function. Options control the type of line (linear, quadratic, nonparametric), the thickness of the line, the line’s color, and the presence or absence of a confidence interval. Here we request a linear regression (method = lm) line (where lm stands for linear model).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add a line of best fit\nggplot(data = insurance,\n         mapping = aes(x = age, y = expenses)) +\n    geom_point(color = \"cornflowerblue\",\n                 alpha = .7,\n                 size = 2) +\n  geom_smooth(method = \"lm\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Add a line of best fit with geom_smooth()](intro_files/figure-html/fig-ggplot-line-of-best-fit-1.png){#fig-ggplot-line-of-best-fit width=672}\n:::\n:::\n\n\nIn @fig-ggplot-line-of-best-fit, we added a line of best fit using `geom_smooth(method = \"lm\")`. The `method` argument specifies the type of smoothing to apply. In this case, we used a linear model (lm) to fit the line.\n\n## Grouping\n\nIn addition to mapping variables to the x and y axes, groups of observations can be mapped to the color, shape, size, transparency, and other visual characteristics of geometric objects. This allows groups of observations to be superimposed in a single graph.\n\nLet’s add smoker status to the plot and represent it by color.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# group points by smoker status\nggplot(data = insurance,\n       mapping = aes(x = age, y = expenses, color = smoker)) +\n  geom_point(alpha = .7, size = 2) +\n  geom_smooth(method = \"lm\", se = FALSE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Group points by smoker status.](intro_files/figure-html/fig-ggplot-grouping-1.png){#fig-ggplot-grouping width=672}\n:::\n:::\n\n\nIn @fig-ggplot-grouping, we added the `color` aesthetic to the `aes()` function to map the `smoker` variable to the color of the points and the line of best fit. This allows us to see how the relationship between age and expenses differs for smokers and non-smokers. It probably comes as no surprise that smokers appear to incur greater expenses than non-smokers.\n\n\n## Scales\n\nScales control how variables are mapped to the visual characteristics of the plot. Scale functions (which start with `scale_`) allow you to modify this mapping. In the next plot, we’ll change the x and y axis scaling, and the colors employed.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# modify scales for x and y axes, and colors\n# modify the x and y axes and specify the colors to be used\nggplot(data = insurance,\n       mapping = aes(x = age, \n                     y = expenses,\n                     color = smoker)) +\n  geom_point(alpha = .5,\n             size = 2) +\n  geom_smooth(method = \"lm\", \n              se = FALSE, \n              size = 1.5) +\n  scale_x_continuous(breaks = seq(0, 70, 10)) +\n  scale_y_continuous(breaks = seq(0, 60000, 20000),\n                     label = scales::dollar) +\n  scale_color_manual(values = c(\"indianred3\", \n                                \"cornflowerblue\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Modify scales for x and y axes, and colors.](intro_files/figure-html/fig-ggplot-scales-1.png){#fig-ggplot-scales width=672}\n:::\n:::\n\n\nIn @fig-ggplot-scales, we used `scale_x_continuous()` and `scale_y_continuous()` to modify the x and y axes, respectively. The `breaks` argument specifies the tick marks on the axes, and the `label` argument in `scale_y_continuous()` formats the y-axis labels as dollar amounts using the `scales::dollar` function. We also used `scale_color_manual()` to specify custom colors for the points based on smoker status.\n\n## Facets\n\nFaceting allows you to create multiple plots based on a categorical variable. This is useful for comparing distributions or relationships across different groups. The `facet_wrap()` function is commonly used for this purpose. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# create facets based on the obese variable\n# reproduce plot for each obsese and non-obese individuals\nggplot(data = insurance,\n       mapping = aes(x = age, \n                     y = expenses,\n                     color = smoker)) +\n  geom_point(alpha = .5) +\n  geom_smooth(method = \"lm\", \n              se = FALSE) +\n  scale_x_continuous(breaks = seq(0, 70, 10)) +\n  scale_y_continuous(breaks = seq(0, 60000, 20000),\n                     label = scales::dollar) +\n  scale_color_manual(values = c(\"indianred3\", \n                                \"cornflowerblue\")) +\n  facet_wrap(~obese)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Create facets based on the obese variable.](intro_files/figure-html/fig-ggplot-facets-1.png){#fig-ggplot-facets width=672}\n:::\n:::\n\n\nIn @fig-ggplot-facets, we used `facet_wrap(~obese)` to create separate plots for obese and non-obese individuals. This allows us to compare the relationship between age and expenses for these two groups side by side. Pretty cool, right? We have now created a plot that shows the relationships among age, smoking status, obesity, and annual medical expenses. In essence, we have placed four dimensions of data into a two-dimensional plot!\n\n## Labels and Titles\n\nLabels and titles are important for making your plots informative and easy to understand. The `labs()` function is used to add labels to the x and y axes, as well as a title for the plot.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add labels and title to the plot\n# add informative labels\nggplot(data = insurance,\n       mapping = aes(x = age, \n                     y = expenses,\n                     color = smoker)) +\n  geom_point(alpha = .5) +\n  geom_smooth(method = \"lm\", \n              se = FALSE) +\n  scale_x_continuous(breaks = seq(0, 70, 10)) +\n  scale_y_continuous(breaks = seq(0, 60000, 20000),\n                     label = scales::dollar) +\n  scale_color_manual(values = c(\"indianred3\", \n                                \"cornflowerblue\")) +\n  facet_wrap(~obese) +\n  labs(title = \"Relationship between patient demographics and medical costs\",\n       subtitle = \"US Census Bureau 2013\",\n       caption = \"source: http://mosaic-web.org/\",\n       x = \" Age (years)\",\n       y = \"Annual expenses\",\n       color = \"Smoker?\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Add labels and title to the plot.](intro_files/figure-html/fig-ggplot-labels-1.png){#fig-ggplot-labels width=672}\n:::\n:::\n\n\n\nIn @fig-ggplot-labels, we used the `labs()` function to add a title, subtitle, caption, and labels for the x and y axes. This makes the plot more informative and easier to interpret. \n\n## Theming\n\nFinally, we can fine tune the appearance of the graph using themes. Theme functions (which start with theme_) control background colors, fonts, grid-lines, legend placement, and other non-data related features of the graph. Let’s use a cleaner theme.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# customize the plot's appearance with themes\n# use a minimalist theme\nggplot(data = insurance,\n       mapping = aes(x = age, \n                     y = expenses,\n                     color = smoker)) +\n  geom_point(alpha = .5) +\n  geom_smooth(method = \"lm\", \n              se = FALSE) +\n  scale_x_continuous(breaks = seq(0, 70, 10)) +\n  scale_y_continuous(breaks = seq(0, 60000, 20000),\n                     label = scales::dollar) +\n  scale_color_manual(values = c(\"indianred3\", \n                                \"cornflowerblue\")) +\n  facet_wrap(~obese) +\n  labs(title = \"Relationship between age and medical expenses\",\n       subtitle = \"US Census Data 2013\",\n       caption = \"source: https://github.com/dataspelunking/MLwR\",\n       x = \" Age (years)\",\n       y = \"Medical Expenses\",\n       color = \"Smoker?\") +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Customize the plot's appearance with themes.](intro_files/figure-html/fig-ggplot-theming-1.png){#fig-ggplot-theming width=672}\n:::\n:::\n\n\n## Conclusion\n\nIn this chapter, we explored the insurance dataset using `ggplot2`, a powerful visualization package in R. We learned how to initialize a plot with `ggplot()`, add layers with `geom_*()` functions, group observations, modify scales, create facets, add labels and titles, and customize the plot's appearance with themes.\n\nOur final plot:\n\nNow we have something. From @fig-ggplot-theming it appears that:\n\n* There is a positive linear relationship between age and expenses. The relationship is constant across smoking and obesity status (i.e., the slope doesn’t change).\n* Smokers and obese patients have higher medical expenses.\n* There is an interaction between smoking and obesity. Non-smokers look fairly similar across obesity groups. However, for smokers, obese patients have much higher expenses.\n* There are some very high outliers (large expenses) among the obese smoker group.\n\nThese findings are tentative. They are based on a limited sample size and do not involve statistical testing to assess whether differences may be due to chance variation.\n\n",
    "supporting": [
      "intro_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}